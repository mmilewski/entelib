{% extends 'base_with_top_menu.html' %}

{% load go_back_link %}

{% block title %}{{ book.title }}{% endblock %}

{% block header %}{% if for_whom %} {{ for_whom }} {% else %} Book copies {% endif %} {% endblock %}

{% block content %}
    {% if not time_bar %}}
    <script type="text/javascript">
      $(document).ready(function()  { $("#booklist").tablesorter( {sortList: [[1,0], [2,0]]} ); } );
    </script>
    {% endif %}

    <h2>Title: {{ book.title }}</h2>

    <div class="book_authors">
        <dt>Authors:</dt>
        {% if book.authors %}
        <dd>{{ book.authors|join:', '}}</dd>
        {% else %}
        <dd>No authors.</dd>
        {% endif %}
    </div>

    <div class="book_categories">
      <dt>Categories:</dt>
      {% if book.categories %}
      <dd>{{ book.categories|join:", " }}</dd>
      {% else %}
      <dd>This book wasn't assigned to any category.</dd>
      {% endif %}
    </div>


    <div class="tip">
      <p>1. If you use Firefox or Opera you can click and drag to multiselect locations. In Chrome you can use CTRL+click</p>
      <p>2. Selecting "Any" has effect only iff nothing else is selected. If "Any" and sth else is selected, then "Any" would be deselected</p>
    </div>
    <div class='content_form'>
        <form action='.' method='post'>
            <table>
                <tr>
                    <td>Location: </td>
                    <td>
                        <select name='location' multiple='multiple' size='{{ search.copies_location_select_size }}'>
                            {% for location in search.locations %}
                                <option value='{{ location.id }}' {% if location.selected %}selected{% endif %}>{{ location.name }}</option>
                            {% endfor %}
                        </select>
                    </td>
                </tr><tr>
                    <td>Only available: </td>
                    <td>
                        <input type='checkbox' name='available' value='available' {% if only_available_checked %} checked='checked' {% endif %} >
                    </td>
                </tr><tr>
                    <td></td><td>
                        <input type='submit'  name='action' value='Search'>
                    </td></tr>
            </table>
        </form>
    </div>

    <div class="bookcopy_actions">
      {% if can_add_bookcopy %}
      <a href="/entelib/admin/baseapp/bookcopy/add/?book={{book.id}}" class="add_bookcopy">Add another copy</a>
      {% endif %}
    </div>

    {% comment %}
    If no argument is specified, then default one will be loaded - which is set in Config.
    Try typing:
    {% go_back_link %}
    {% endcomment %}
    {% go_back_link "Go back" %}

    <div class="book_copies">
      <h3 id="book_copies">Copies of this book:</h3>
      <div class="tip">
        <p>1. Hold shift and then press header to select by multiple columns.</p>
        <p>2. If you reserve book that is unavailable, you will be <em>unable</em> to rent it.</p>
      </div>
        <!-- <ul class='booklist'>
        {% for item in book.items %}
        <li><b><a href='{{ item.url }}'>>></a></b>:
            <ul>
            <li>Location: {{ item.location }}</li>
            <li>State: {{ item.state }}</li>
            <li>Publisher: {{ item.publisher }}</li>
            <li>Year: {{ item.year }}</li>
            <li><a href='{{ item.desc_url}}'>External description</a> </li>
            <li><a href='{{ item.reserve_url }}'>Reserve</a></li>
            </ul>
        </li>
        {% empty %}
        <b>Sorry, no copies.</b>
        {% endfor %}
        </ul> -->
        {% if book.items %}
            <table id="booklist" class="tablesorter booklist">
                <thead>
                    <tr>
                    <th></th>
                    <th>Location</th>
                    <th title="aka Shelf mark">Id</th>
                    <th>State</th>
                    <th>Publisher</th>
                    <th>Year</th>
                    <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% if time_bar %}
                    <tr id='tr_range'></tr>
                    {% endif %}
                {% for item in book.items %}
                    {% if time_bar %}
                    <tr id='tr_{{ item.shelf_mark }}'></tr>
                    {% endif %}
                    <tr>
                        <td class="url"><a href='{{ item.url }}'><img src="{{MEDIA_URL}}/images/details.png"></a></td>
                        <td class="location">{{ item.location }}</td>
                        <td class="shelfmark">{{ item.shelf_mark }}</td>
                        <td class="state">{{ item.state }} {% if not item.is_available %}<span style="color:red;" title="Unavailable, sorry"><br/>(unavailable)</span>{%endif%}</td>
                        <td class="publisher">{{ item.publisher }}</td>
                        <td class="year">{{ item.year }}</td>
                        <td class="actions">
                            <ul class="actions">
                                <!-- <li><a href='{{ item.desc_url}}'>External description</a></li> -->
                                {%if item.is_reservable %}<li><a href='{{ item.reserve_url }}'
                                                                 {% if not item.is_available %}class="available" title="Book is not available"{% endif %}>
                                                                 Reserve
                                                              </a></li> {% endif %}
                            </ul>
                        </td>
                    </tr>
                    {% if time_bar %}
                    <script type='text/javascript'>
                    <!--
                        $(document).ready(function()
                        {
                            array = new Array();
                            i = 0;
                            
                            {% for pair in item.when_reserved %}
                                pair = new Array(2);
                                pair[0] = "{{ pair.from }}";
                                pair[1] = "{{ pair.to }}";
                                array[i] = pair;
                                i++;
                            {% endfor %}
                            
                            item_last_day = "{{ last_date }}";
                            item_id = "tr_{{ item.shelf_mark }}";
                            
                            make_time_bar(array, i, item_last_day, item_id);
                        })
                    //-->
                    </script>
                    {% endif %}
                {% endfor %}
                </tbody>
            </table>
        {% else %}
            <br><b>No copies.</b>
        {% endif %}
    </div>
    {% go_back_link "Go back" %}

    <script type='text/javascript'>
    <!--
        $(document).ready(function()
        {
            var posX = 0;
            var posY = 0;
            
            $(".green").mousemove(function(e)
            {
                if (!e) var e = window.event;
                $("#cloud").html($('input[name=val]', this).val());
                $("#cloud").show();
                if (e.pageX || e.pageY)
                {
                    posX =  e.pageX - document.body.scrollLeft -
                            document.documentElement.scrollLeft + 10;
                    posY = e.pageY - document.body.scrollTop -
                            document.documentElement.scrollTop - 30;
                }
                else
                    if (e.clientX || e.clientY)
                    {
                        posX = e.clientX + 10;
                        posY = e.clientY - 30;
                    }
                $('#cloud').css({'left': posX, 'top': posY}); 
            });            
            $(".green").mouseout(function()
            {
                $("#cloud").hide(); 
            });
            $(".red").mousemove(function(e)
            {
                
                if (!e) var e = window.event;
                $("#cloud").html($('input[name=val]', this).val());
                $("#cloud").show();
                if (e.pageX || e.pageY)
                {
                    posX =  e.pageX - document.body.scrollLeft -
                            document.documentElement.scrollLeft + 10;
                    posY = e.pageY - document.body.scrollTop -
                            document.documentElement.scrollTop - 30;
                }
                else
                    if (e.clientX || e.clientY)
                    {
                        posX = e.clientX + 10;
                        posY = e.clientY - 30;
                    }
                $('#cloud').css({'left': posX, 'top': posY}); 
            });            
            $(".red").mouseout(function()
            {
                $("#cloud").hide(); 
            })
        })
    //-->
    </script>
    <div id="cloud" class='cloud'></div>

{% endblock %}
